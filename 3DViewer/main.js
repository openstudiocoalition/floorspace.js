let os_data,renderer,scene,light,scene_objects,scene_edges,object_edges,coincident_objects,back_objects,perspectiveCamera,orthographicCamera,perspectiveControls,orthographicControls,project,materials,letiable,dateTimeControl,colorBar,colorBarContainer,colorBarHeight,colorBarWidth,mouseDownX,mouseDownY,raycaster,mouse,headsUp,intersected,selected_material;const getStringFromLocalStorage=function(e,t){try{const a=localStorage.getItem(e);return null==a?t:a}catch(e){return t}},getBoolFromLocalStorage=function(e,t){try{const a=localStorage.getItem(e);return null==a?t:"true"===a}catch(e){return t}},getFloatFromLocalStorage=function(e,t){try{const a=localStorage.getItem(e);return null==a?t:parseFloat(a)}catch(e){return t}},setLocalStorage=function(e,t){try{localStorage.setItem(e,t)}catch(e){}};function cameraLookAt(){return new THREE.Vector3(os_data.metadata.boundingBox.lookAtX,os_data.metadata.boundingBox.lookAtZ,-os_data.metadata.boundingBox.lookAtY)}function cameraRadius(){return 4*os_data.metadata.boundingBox.lookAtR}function setCameraAngles(e,t,a,o,r){const n=cameraLookAt(),s=Math.sqrt(Math.pow(e.position.x-n.x,2)+Math.pow(e.position.y-n.y,2)+Math.pow(e.position.z-n.z,2)),i=cameraRadius(),l=i*Math.cos(a*Math.PI/180)*Math.cos(o*Math.PI/180)+n.x,c=i*Math.sin(o*Math.PI/180)+n.y,d=-i*Math.sin(a*Math.PI/180)*Math.cos(o*Math.PI/180)+n.z;let u=0,g=1,m=0;90===o&&(u=0,g=1,m=-.01);const h={progress:0,start:{x:e.position.x,y:e.position.y,z:e.position.z,r:s,theta:Math.acos(e.position.z/s),phi:Math.atan2(e.position.y,e.position.x),upX:e.up.x,upY:e.up.y,upZ:e.up.z,lookAtX:t.target.x,lookAtY:t.target.y,lookAtZ:t.target.z,targetX:t.target.x,targetY:t.target.y,targetZ:t.target.z,zoom:e.zoom},end:{x:l,y:c,z:d,r:i,theta:Math.acos(d/i),phi:Math.atan2(c,l),upX:u,upY:g,upZ:m,lookAtX:n.x,lookAtY:n.y,lookAtZ:n.z,targetX:n.x,targetY:n.y,targetZ:n.z,zoom:1}};TweenLite.to(h,r,{progress:1,ease:Power3.easeInOut,onUpdate(a){const o=a.target.start.r+a.target.progress*(a.target.end.r-a.target.start.r),r=a.target.start.theta+a.target.progress*(a.target.end.theta-a.target.start.theta),n=a.target.start.phi+a.target.progress*(a.target.end.phi-a.target.start.phi),s=a.target.start.zoom+a.target.progress*(a.target.end.zoom-a.target.start.zoom),i=o*Math.sin(r)*Math.cos(n),l=o*Math.sin(r)*Math.sin(n),c=o*Math.cos(r),d=a.target.start.upX+a.target.progress*(a.target.end.upX-a.target.start.upX),u=a.target.start.upY+a.target.progress*(a.target.end.upY-a.target.start.upY),g=a.target.start.upZ+a.target.progress*(a.target.end.upZ-a.target.start.upZ),m=a.target.start.lookAtX+a.target.progress*(a.target.end.lookAtX-a.target.start.lookAtX),h=a.target.start.lookAtY+a.target.progress*(a.target.end.lookAtY-a.target.start.lookAtY),p=a.target.start.lookAtZ+a.target.progress*(a.target.end.lookAtZ-a.target.start.lookAtZ),b=a.target.start.targetX+a.target.progress*(a.target.end.targetX-a.target.start.targetX),w=a.target.start.targetY+a.target.progress*(a.target.end.targetY-a.target.start.targetY),y=a.target.start.targetZ+a.target.progress*(a.target.end.targetZ-a.target.start.targetZ);e.position.set(i,l,c),e.zoom=s,e.up.set(d,u,g),e.lookAt(new THREE.Vector3(m,h,p)),e.updateProjectionMatrix(),t.target=new THREE.Vector3(b,w,y)},onUpdateParams:["{self}"],onComplete(){e.position.set(l,c,d),e.zoom=1,e.up.set(u,g,m),e.lookAt(n),e.updateProjectionMatrix(),t.target=n}})}function setAllCameraAngles(e,t,a){let o=a,r=a;getBoolFromLocalStorage("useOthrographic",!1)?o=0:r=0,setCameraAngles(perspectiveCamera,perspectiveControls,e,t,o),setCameraAngles(orthographicCamera,orthographicControls,e,t,r)}const settings={renderBy:"Surface Type",showStory:"All Stories",showFloors:getBoolFromLocalStorage("showFloors",!0),showWalls:getBoolFromLocalStorage("showWalls",!0),showRoofCeilings:getBoolFromLocalStorage("showRoofCeilings",!0),showWindows:getBoolFromLocalStorage("showWindows",!0),showDoors:getBoolFromLocalStorage("showDoors",!0),showShading:getBoolFromLocalStorage("showShading",!0),showPartitions:getBoolFromLocalStorage("showPartitions",!0),showWireframe:getBoolFromLocalStorage("showWireframe",!0),xView(){setAllCameraAngles(0,0,1)},yView(){setAllCameraAngles(-90,0,1)},zView(){setAllCameraAngles(0,90,1)},reset(){setAllCameraAngles(-30,30,1)},orthographic:getBoolFromLocalStorage("useOthrographic",!1),xSection:0,ySection:0,zSection:0,letiableName:"",colorScheme:getStringFromLocalStorage("colorScheme","diverging"),daySlider:0,hourSlider:1,cycleHour:!1,cycleSpeed:getFloatFromLocalStorage("cycleSpeed",1),rotateColorBar:getBoolFromLocalStorage("rotateColorBar",!1),dateTime:""};function erf(e){let t=1;e<0&&(t=-1);const a=Math.abs(e),o=1/(1+.3275911*a);return t*(1-((((1.061405429*o-1.453152027)*o+1.421413741)*o-.284496736)*o+.254829592)*o*Math.exp(-a*a))}const getColor=function(e,t,a,o){if(null==e)return new THREE.Color(255,255,255);const r=(Math.min(Math.max(e,t),a)-t)/(a-t);let n=1-r,s=1-r,i=1-r;switch(o){case"sequential":n=1-.392*(1+erf((r-.869)/.255)),i=1.021-.456*(1+erf((r-.527)/.376)),s=1-.493*(1+erf((r-.272)/.309));break;case"diverging":n=.237-2.13*r+26.92*Math.pow(r,2)-65.5*Math.pow(r,3)+63.5*Math.pow(r,4)-22.36*Math.pow(r,5),i=Math.pow((.572+1.524*r-1.811*Math.pow(r,2))/(1-.291*r+.1574*Math.pow(r,2)),2),s=1/(1.579-4.03*r+12.92*Math.pow(r,2)-31.4*Math.pow(r,3)+48.6*Math.pow(r,4)-23.36*Math.pow(r,5));break;case"rainbow":n=(.472-.567*r+4.05*Math.pow(r,2))/(1+8.72*r-19.17*Math.pow(r,2)+14.1*Math.pow(r,3)),i=.108932-1.22635*r+27.284*Math.pow(r,2)-98.577*Math.pow(r,3)+163.3*Math.pow(r,4)-131.395*Math.pow(r,5)+40.634*Math.pow(r,6),s=1/(1.97+3.54*r-68.5*Math.pow(r,2)+243*Math.pow(r,3)-297*Math.pow(r,4)+125*Math.pow(r,5))}return new THREE.Color(n,i,s)};function fitInWindow(){const e=document.getElementById("color-bar-container").style;if(settings.rotateColorBar){const t=(colorBarWidth+42)/2,a=colorBarWidth+42,o=colorBarHeight+112,r=parseInt(e.top,10)-t,n=parseInt(e.left,10)+t;n<0?e.left=-t+"px":window.innerWidth<n+o&&(e.left=window.innerWidth-o-t+"px"),r<0?e.top=`${t}px`:window.innerHeight<r+a&&(e.top=`${window.innerHeight-a+t}px`)}else{const t=colorBarHeight+112,a=colorBarWidth+42,o=parseInt(e.top,10),r=parseInt(e.left,10);r<0?e.left=0:window.innerWidth<r+a&&(e.left=window.innerWidth-a+"px"),o<0?e.top=0:window.innerHeight<o+t&&(e.top=window.innerHeight-t+"px")}}function updateColorBarSelection(e){const t=document.getElementById("color-bar-selection-line"),a=document.getElementById("color-bar-selection-text");if(""!==e){const o=(e-letiable.valueMin)/(letiable.valueMax-letiable.valueMin);t.style.left=20+colorBarWidth*o+"px",a.style.left=10+colorBarWidth*o+"px",a.innerHTML=Math.round(100*e)/100}else t.style.display="none",a.style.display="none"}function updateBalloon(e){let t=document.getElementById("balloon-letiable-name");t&&(t.innerHTML=e.userData.letiableName),t=document.getElementById("balloon-letiable-key-name"),t&&(t.innerHTML=e.userData.letiableKeyName),t=document.getElementById("balloon-letiable-date"),t&&(t.innerHTML=e.userData.letiableDate),t=document.getElementById("balloon-letiable-time"),t&&(t.innerHTML=e.userData.letiableTime),t=document.getElementById("balloon-letiable-value"),t&&(t.innerHTML=e.userData.letiableValue)}function restoreLastMaterial(e){e.visible=e.wasVisible,e.material=e.lastMaterial,e.material&&(e.material.needsUpdate=!0),e.lastMaterial=null}function setSelectedMaterial(e){e.wasVisible=e.visible,e.lastMaterial=e.material,e.visible=!0,e.material=selected_material,e.material.needsUpdate=!0}function removeMaterial(e){e.wasVisible=e.visible,e.lastMaterial=e.material,e.visible=!1,e.material=null}const updateColorBar=function(){const e=colorBar.getContext("2d"),t=e.createImageData(colorBarWidth,colorBarHeight),a=[];for(let e=0;e<colorBarWidth;e++){const t=getColor(e,0,colorBarWidth-1,settings.colorScheme);a[4*e]=255*t.r,a[4*e+1]=255*t.g,a[4*e+2]=255*t.b,a[4*e+3]=255}for(let e=0;e<t.data.length;e++)t.data[e]=a[e%(4*colorBarWidth)];e.putImageData(t,0,0),document.getElementById("color-bar-min").innerHTML=Math.round(100*letiable.valueMin)/100,document.getElementById("color-bar-max").innerHTML=Math.round(100*letiable.valueMax)/100};let gui=null,dataFolder=null;function update(){const e=settings.renderBy,t="Data"===e;if(t&&!dataFolder){const e=[];os_data.letiables.forEach((t=>{e.push(t.name)})),letiable=os_data.letiables[0],settings.letiableName=letiable.name,dataFolder=gui.addFolder("Data Rendering"),dataFolder.add(settings,"letiableName",e).name("letiable").onChange((e=>{const t=os_data.letiables.filter((t=>t.name===e));t.length&&(letiable=t[0]),updateColorBar(),update()})),dataFolder.add(settings,"colorScheme",{Grayscale:"grayscale",Sequential:"sequential",Diverging:"diverging",Rainbow:"rainbow"}).name("Color Scheme").onChange((e=>{setLocalStorage("colorScheme",e),updateColorBar(),update(e)})),dataFolder.add(settings,"daySlider",0,letiable.numDays-1,1).name("Day").onChange(update),dataFolder.add(settings,"hourSlider",letiable.hoursPerInterval,24).step(letiable.hoursPerInterval).name("Hour").listen().onChange(update),dateTimeControl=dataFolder.add(settings,"dateTime").name("Date Time").listen(),dataFolder.add(settings,"rotateColorBar").name("Rotate Color Bar").onChange((e=>{e?colorBarContainer.classList.add("rotate"):colorBarContainer.classList.remove("rotate"),fitInWindow(),setLocalStorage("rotateColorBar",e)})),dataFolder.add(settings,"cycleHour").name("Cycle Hour").onChange((e=>{if(e){const e=()=>{settings.cycleHour&&(settings.hourSlider=settings.hourSlider%24+1,update(),setTimeout(e,1e3/settings.cycleSpeed))};e()}})),dataFolder.add(settings,"cycleSpeed",1,10).name("Cycle Speed").onChange((e=>{setLocalStorage("cycleSpeed",e)})),dataFolder.open(),document.getElementById("color-bar-container").style.display="block",fitInWindow(),updateColorBar()}else!t&&dataFolder&&(gui.removeFolder("Data Rendering"),dataFolder=null,settings.cycleHour&&(settings.cycleHour=!1),document.getElementById("color-bar-container").style.display="none");let a=null,o="",r="",n="";if(t&&letiable){a=Math.floor(letiable.intervalsPerDay*Math.floor(settings.daySlider)+letiable.intervalsPerHour*Math.floor(settings.hourSlider))-1;const e=os_data.times[letiable.timeIndex][a],t=new Date(0);t.setUTCSeconds(e),o=`${`0${t.getUTCMonth()+1}`.slice(-2)}/${`0${t.getUTCDate()}`.slice(-2)}`,r=`${`0${t.getUTCHours()}`.slice(-2)}:${`0${t.getUTCMinutes()}`.slice(-2)}`,settings.dateTime=`${o} - ${r}`,dateTimeControl.updateDisplay(),letiable.units.length&&(n=`(${letiable.units})`)}scene_objects.forEach((t=>{const s=t.userData.surfaceType;t.visible=!0,"All Stories"===settings.showStory||settings.showStory===t.userData.buildingStoryName||(t.visible=!1),(settings.showFloors||"Floor"!==s)&&(settings.showWalls||"Wall"!==s)&&(settings.showRoofCeilings||"RoofCeiling"!==s)?!settings.showWindows&&s.indexOf("Window")>-1?t.visible=!1:!settings.showWindows&&s.indexOf("GlassDoor")>-1||(!settings.showWindows&&s.indexOf("Skylight")>-1||!settings.showWindows&&s.indexOf("TubularDaylight")>-1||!settings.showDoors&&s.indexOf("Door")>-1||!settings.showShading&&s.indexOf("Shading")>-1?t.visible=!1:settings.showPartitions||"InteriorPartitionSurface"!==s||(t.visible=!1)):t.visible=!1;let i,l,c,d=null,u=null,g=null;switch(e){case"Surface Type":d=materials[t.userData.surfaceTypeMaterialName],u=d,coincident_objects[t.uuid]&&(d=materials[`${t.userData.surfaceTypeMaterialName}_Int`]),g=materials[`${t.userData.surfaceTypeMaterialName}_Int`];break;case"Normal":d=materials.NormalMaterial,u=d,coincident_objects[t.uuid]&&(d=materials.NormalMaterial_Int),g=materials.NormalMaterial_Int;break;case"Boundary":d=materials[t.userData.boundaryMaterialName];break;case"Construction":d=materials[t.userData.constructionMaterialName];break;case"Thermal Zone":d=materials[t.userData.thermalZoneMaterialName];break;case"Space Type":d=materials[t.userData.spaceTypeMaterialName];break;case"Building Story":d=materials[t.userData.buildingStoryMaterialName];break;case"Data":if(i=null,l="",c=t.userData.letiables.filter((e=>e.name===settings.letiableName)),c.length>0){const e=c[0];null!==e.valueIndex&&(i=letiable.values[e.valueIndex][a]),null!==e.keyName&&(l=e.keyName)}null!==i?(t.userData.letiableName=settings.letiableName,t.userData.letiableDate=o,t.userData.letiableTime=r,t.userData.letiableKeyName=l,t.userData.letiableValue=i,t.userData.letiableUnits=n):(t.userData.letiableName=settings.letiableName,t.userData.letiableDate=o,t.userData.letiableTime=r,t.userData.letiableKeyName=l,t.userData.letiableValue="",t.userData.letiableUnits=n),d=new THREE.MeshBasicMaterial({side:THREE.DoubleSide}),d.color.set(getColor(i,letiable.valueMin,letiable.valueMax,settings.colorScheme))}intersected&&(updateBalloon(intersected),updateColorBarSelection(intersected.userData.letiableValue)),d||(d=materials.Undefined,console.log(`${e}: could not find material for ${JSON.stringify(t.userData)}`)),u||(u=d),g||(g=d),t.material=d,t.material_double_sided=u,null!==d&&(t.material.needsUpdate=!0);const m=object_edges[t.uuid];settings.showWireframe||t.visible?m.visible=!0:m.visible=!1;const h=back_objects[t.uuid];h&&(h.material=g,null!==g?(h.visible=t.visible,h.material.needsUpdate=!0):h.visible=!1)})),scene_objects.forEach((e=>{if(e.visible){const t=coincident_objects[e.uuid];if(t){const a=back_objects[e.uuid];a&&(t.visible?a.visible=!1:(a.visible=!0,e.material_double_sided&&(e.material=e.material_double_sided,e.material.needsUpdate=!0)))}}}))}function selectObject(e){const t="Data"===settings.renderBy;if(intersected!==e){if(intersected){const e=object_edges[intersected.uuid];e&&(e.material.color.setRGB(0,0,0),e.material.linewidth=1,e.material.needsUpdate=!0)}if(!t&&intersected){restoreLastMaterial(intersected);const e=coincident_objects[intersected.uuid];e&&restoreLastMaterial(e);const t=back_objects[intersected.uuid];t&&restoreLastMaterial(t)}if(intersected=e,intersected){const e=object_edges[intersected.uuid];e&&(e.material.color.setRGB(0,255,0),e.material.linewidth=4,e.material.needsUpdate=!0)}if(!t&&intersected){setSelectedMaterial(intersected);const e=coincident_objects[intersected.uuid];e&&removeMaterial(e);const t=back_objects[intersected.uuid];t&&removeMaterial(t)}t&&intersected&&update()}}function removeSelection(){selectObject(null),headsUp.style.display="none",document.body.style.cursor="auto",document.getElementById("color-bar-selection-line").style.display="none",document.getElementById("color-bar-selection-text").style.display="none"}function parseMaterials(e){const t={},a=new THREE.MaterialLoader;for(let o=0,r=e.length;o<r;o++){const r=e[o],n=a.parse(r);n.uuid=r.uuid,n.name=r.name,t[r.name]=n}return t}function onDocumentMouseDown(e){mouseDownX=e.clientX,mouseDownY=e.clientY}function onDocumentMouseClick(e){if(mouseDownX===e.clientX&&mouseDownY===e.clientY){mouse.x=e.clientX/renderer.domElement.width*2-1,mouse.y=-e.clientY/renderer.domElement.height*2+1,settings.orthographic?raycaster.setFromCamera(mouse,orthographicCamera):raycaster.setFromCamera(mouse,perspectiveCamera);const t=scene_objects.filter((e=>e.visible)),a=raycaster.intersectObjects(t);if(a.length){selectObject(a[0].object),headsUp.style.left=10+.5*window.innerWidth+.5*mouse.x*window.innerWidth+"px",headsUp.style.top=.5*window.innerHeight-10-.5*mouse.y*window.innerHeight+"px",headsUp.style.display="block",document.getElementById("color-bar-selection-line").style.display="block",document.getElementById("color-bar-selection-text").style.display="inline-block";let e=`Name: ${intersected.userData.name}<br>`;switch(settings.renderBy){case"Surface Type":case"Normal":e+=`Surface Type: ${intersected.userData.surfaceType}<br>`,intersected.userData.spaceName&&(e+=`Space Name: ${intersected.userData.spaceName}`);break;case"Boundary":intersected.userData.outsideBoundaryCondition&&(e+=`Outside Boundary Condition: ${intersected.userData.outsideBoundaryCondition}<br>`),e+=`Sun Exposure: ${intersected.userData.sunExposure}<br>`,e+=`Wind Exposure: ${intersected.userData.windExposure}`;break;case"Construction":intersected.userData.constructionName&&(e+=`Construction Name: ${intersected.userData.constructionName}`);break;case"Thermal Zone":intersected.userData.thermalZoneName&&(e+=`Thermal Zone: ${intersected.userData.thermalZoneName}`);break;case"Space Type":intersected.userData.spaceTypeName&&(e+=`Space Type: ${intersected.userData.spaceTypeName}`);break;case"Building Story":intersected.userData.buildingStoryName&&(e+=`Story Name: ${intersected.userData.buildingStoryName}`);break;case"Data":""!==intersected.userData.letiableValue&&(e+=`letiable: <span id="balloon-letiable-name">${intersected.userData.letiableName}</span><br>`,e+=`Key: <span id="balloon-letiable-key-name">${intersected.userData.letiableKeyName}</span><br>`,e+=`Date: <span id="balloon-letiable-date">${intersected.userData.letiableDate}</span><br>`,e+=`Time: <span id="balloon-letiable-time">${intersected.userData.letiableTime}</span><br>`,e+=`Value: <span id="balloon-letiable-value">${intersected.userData.letiableValue}</span> ${intersected.userData.letiableUnits}`),updateColorBarSelection(intersected.userData.letiableValue)}headsUp.innerHTML=e,document.body.style.cursor="pointer"}else removeSelection()}}function init(e){os_data=e;document.head.appendChild(document.createElement("style")).innerHTML="body { font:600 12pt monospace; margin:0; overflow:hidden; }",headsUp=document.body.appendChild(document.createElement("div")),headsUp.setAttribute("id","heads-up"),colorBarHeight=40,colorBarWidth=256,colorBar=document.createElement("canvas"),colorBar.setAttribute("id","color-bar"),colorBar.setAttribute("height",colorBarHeight),colorBar.setAttribute("width",colorBarWidth),document.documentElement.setAttribute("ondrop","drop(event)"),document.documentElement.setAttribute("ondragover","allowDrop(event)");const t=getFloatFromLocalStorage("colorBarTop",0),a=getFloatFromLocalStorage("colorBarLeft",0);colorBarContainer=document.body.appendChild(document.createElement("div")),colorBarContainer.setAttribute("id","color-bar-container"),colorBarContainer.setAttribute("draggable","true"),colorBarContainer.setAttribute("ondragstart","drag(event)"),colorBarContainer.style.height=`${colorBarHeight+112}px`,colorBarContainer.style.width=`${colorBarWidth+42}px`,colorBarContainer.style.top=`${t}px`,colorBarContainer.style.left=`${a}px`,settings.rotateColorBar&&colorBarContainer.classList.add("rotate"),colorBarContainer.appendChild(colorBar);let o=document.createElement("div");o.classList.add("color-bar-tick"),o.style.bottom=`${colorBarHeight+21}px`,o.style.left="20px",colorBarContainer.appendChild(o),o=o.cloneNode(),o.style.left=`${20+colorBarWidth}px`,colorBarContainer.appendChild(o),o=o.cloneNode(),o.setAttribute("id","color-bar-selection-line"),o.style.display="none",o.style.bottom="20px",o.style.height="56px",colorBarContainer.appendChild(o);let r=document.createElement("span");r.classList.add("color-bar-text"),r.setAttribute("id","color-bar-min"),r.style.bottom=`${colorBarHeight+30}px`,r.style.left="10px",colorBarContainer.appendChild(r),r=r.cloneNode(),r.setAttribute("id","color-bar-max"),r.style.left=`${10+colorBarWidth}px`,colorBarContainer.appendChild(r),r=r.cloneNode(),r.setAttribute("id","color-bar-selection-text"),colorBarContainer.appendChild(r),renderer=new THREE.WebGLRenderer({alpha:1,antialias:!0,clearColor:16777215}),renderer.setSize(window.innerWidth,window.innerHeight),renderer.shadowMapEnabled=!0,renderer.shadowMapSoft=!0,document.body.appendChild(renderer.domElement),scene=new THREE.Scene,window.scene=scene;const n=window.innerWidth/window.innerHeight;orthographicCamera=new THREE.OrthographicCamera(4*n*os_data.metadata.boundingBox.lookAtR/-2,4*n*os_data.metadata.boundingBox.lookAtR/2,4*os_data.metadata.boundingBox.lookAtR/2,4*os_data.metadata.boundingBox.lookAtR/-2,1,5e3),scene.add(orthographicCamera),orthographicCamera.up.set(0,1,0),orthographicCamera.lookAt(cameraLookAt()),perspectiveCamera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,5e3),scene.add(perspectiveCamera),perspectiveCamera.up.set(0,1,0),perspectiveCamera.lookAt(cameraLookAt()),orthographicControls=new THREE.OrbitControls(orthographicCamera,renderer.domElement),orthographicControls.minDistance=10,orthographicControls.maxDistance=1e3,orthographicControls.enabled=!0,perspectiveControls=new THREE.OrbitControls(perspectiveCamera,renderer.domElement),perspectiveControls.minDistance=10,perspectiveControls.maxDistance=1e3,perspectiveControls.enabled=!0,setAllCameraAngles(-30,30,0),light=new THREE.AmbientLight(12303291),scene.add(light);const s=cameraRadius(),i=new THREE.LineBasicMaterial({color:16711680}),l=new THREE.Geometry;l.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(s,0,0)),scene.add(new THREE.Line(l,i));const c=new THREE.LineBasicMaterial({color:65280}),d=new THREE.Geometry;d.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,-s)),scene.add(new THREE.Line(d,c));const u=new THREE.LineBasicMaterial({color:255}),g=new THREE.Geometry;g.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,s,0)),scene.add(new THREE.Line(g,u)),project=new THREE.Object3D,scene.add(project);const m=(new THREE.ObjectLoader).parse(os_data);project.add(m),scene_objects=project.children[0].children;const h={};scene_objects.forEach((e=>{h[e.userData.handle]=e})),coincident_objects={},scene_objects.forEach((e=>{e.userData.coincidentWithOutsideObject&&(coincident_objects[e.uuid]=h[e.userData.outsideBoundaryConditionObjectHandle])})),scene_edges=[],back_objects={},object_edges={},scene_objects.forEach((e=>{const t=new THREE.EdgesHelper(e,0);scene.add(t);const a=scene.children[scene.children.length-1];scene_edges.push(a),object_edges[e.uuid]=a;let o=e.clone();o.visible=!1,o.name+=" Back",scene.add(o),o=scene.children[scene.children.length-1],o.geometry=e.geometry.clone(),back_objects[e.uuid]=o})),raycaster=new THREE.Raycaster,mouse=new THREE.Vector2,selected_material=new THREE.MeshPhongMaterial({name:"Selected",color:16776960,ambient:16776960,specular:16776960,emissive:16776960,shininess:50,side:THREE.DoubleSide}),materials=parseMaterials(os_data.materials),renderer.domElement.addEventListener("mousedown",onDocumentMouseDown,!1),renderer.domElement.addEventListener("click",onDocumentMouseClick,!1)}function animate(){requestAnimationFrame(animate),orthographicControls.update(),perspectiveControls.update(),settings.orthographic?renderer.render(scene,orthographicCamera):renderer.render(scene,perspectiveCamera)}const initDatGui=function(){const e=os_data.metadata.letiables&&os_data.metadata.letiables.length;dat.GUI.prototype.removeFolder=function(e){this.__folders[e].close(),this.__folders[e].domElement.parentNode.parentNode.removeChild(this.__folders[e].domElement.parentNode),this.__folders[e]=void 0,this.onResize()},gui=new dat.GUI;const t=["Surface Type","Normal","Thermal Zone","Space Type","Building Story"];e&&t.push("Data"),gui.add(settings,"renderBy",t).name("Render By").onChange((e=>{removeSelection(),update(e)}));const a=os_data.metadata.buildingStoryNames;a.unshift("All Stories"),gui.add(settings,"showStory",a).name("Show Story").onChange((e=>{removeSelection(),update(e)}));const o=gui.addFolder("Surface Filters");o.add(settings,"showFloors").name("Show Floors").onChange((e=>{removeSelection(),setLocalStorage("showFloors",e),update(e)})),o.add(settings,"showWalls").name("Show Walls").onChange((e=>{removeSelection(),setLocalStorage("showWalls",e),update(e)})),o.add(settings,"showRoofCeilings").name("Show Roofs").onChange((e=>{removeSelection(),setLocalStorage("showRoofCeilings",e),update(e)})),o.add(settings,"showWindows").name("Show Windows").onChange((e=>{removeSelection(),setLocalStorage("showWindows",e),update(e)})),o.add(settings,"showDoors").name("Show Doors").onChange((e=>{removeSelection(),setLocalStorage("showDoors",e),update(e)})),o.add(settings,"showShading").name("Show Shading").onChange((e=>{removeSelection(),setLocalStorage("showShading",e),update(e)})),o.add(settings,"showPartitions").name("Show Partitions").onChange((e=>{removeSelection(),setLocalStorage("showPartitions",e),update(e)})),o.add(settings,"showWireframe").name("Show Wireframe").onChange((e=>{removeSelection(),setLocalStorage("showWireframe",e),update(e)})),o.open();const r=gui.addFolder("Camera");r.add(settings,"orthographic").name("Orthographic").onChange((e=>{setLocalStorage("orthographic",e)})),r.add(settings,"xView").name("X View"),r.add(settings,"yView").name("Y View"),r.add(settings,"zView").name("Z View"),r.add(settings,"reset").name("Reset"),r.open(),update()},storageKey="floorplan3DExport";Module.addOnPostRun((()=>{const e=localStorage.getItem(storageKey);if(e){const t=Module.floorplanToThreeJS(e,!1);init(JSON.parse(t)),animate(),initDatGui()}window.onstorage=e=>{e.key===storageKey&&location.reload()}}));